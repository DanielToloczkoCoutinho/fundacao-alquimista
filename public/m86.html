<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>VR – Módulo 86: Prisma Estelar e Roda Celeste</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
   
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
   
    <!-- Tone.js para camada sonora -->
    <script src="https://unpkg.com/tone@latest/build/Tone.js"></script>

    <style>
        html, body { margin:0; padding:0; height:100%; overflow:hidden; background:#000; }
        .info-panel {
            position:absolute; top:20px; right:20px; background:rgba(13,13,30,0.8);
            color:#fff; padding:20px; border-radius:15px; font-family: 'Inter', sans-serif;
            max-width:380px; width: 90%; box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            z-index:100; border: 1px solid rgba(138, 43, 226, 0.6); backdrop-filter: blur(8px);
        }
        .info-panel h3 { margin: 0 0 15px; font-size: 1.8em; border-bottom: 1px solid rgba(138, 43, 226, 0.4); padding-bottom: 10px; color: #9370DB; }
        .info-panel p { margin-bottom: 10px; line-height: 1.5; font-size: 1em; color: #e0e0e0; }
        .info-panel strong { color: #BA55D3; }
        .info-panel ul { list-style: none; padding-left: 0; }
        .info-panel li { font-size: 0.9em; color: #d0d0d0; margin-bottom: 5px; background: rgba(255,255,255,0.05); padding: 5px; border-radius: 5px; }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
    </style>
</head>
<body>

    <!-- Painel de Informações sobre o Módulo 86 -->
    <div id="infoPanel" class="info-panel">
        <h3>Módulo 86: Prisma Estelar</h3>
        <p><strong>Status:</strong> <span id="status">Ativado</span></p>
        <p><strong>Função:</strong> Ancoragem da Consciência Multidimensional através da Roda Celeste dos 12 Raios Estelares.</p>
        <p><strong>Raios Ativos:</strong></p>
        <ul id="activeRays">
            <li>Aguardando ressonância...</li>
        </ul>
    </div>

    <!-- Cena A-Frame -->
    <a-scene environment="preset: default; ground: none; skyType: atmosphere; skyColor: #050518; horizonColor: #101028; fog: 0.8"
             background="color: #000"
             renderer="antialias: true, colorManagement: true, physicallyCorrectLights: true">

        <!-- Câmera e Controles -->
        <a-entity id="cameraRig" position="0 1.6 12" movement-controls="speed: 0.3">
            <a-camera look-controls="pointerLockEnabled: false">
                <a-cursor color="#9370DB" raycaster="objects: .collidable"></a-cursor>
            </a-camera>
        </a-entity>

        <!-- Luzes -->
        <a-entity light="type: ambient; intensity: 0.5; color: #D8BFD8"></a-entity>
        <a-entity light="type: point; intensity: 2; distance: 80; decay: 1.5; color: #FFFFFF" position="0 5 0"></a-entity>
        
        <!-- Domo Celeste (Estrelas de Fundo) -->
        <a-entity particle-system="preset: dust; particleCount: 5000; color: #FFF, #AAA, #888"></a-entity>

        <!-- Prisma Estelar Central -->
        <a-entity id="prisma-central" position="0 2 0">
             <a-octahedron radius="1.5" color="#FFF" emissive="#D8BFD8" emissiveIntensity="0.3" transparent="true" opacity="0.6"
                           animation__rotate="property: rotation; to: 0 360 0; dur: 45000; loop: true; easing: linear">
                <a-icosahedron radius="0.5" color="#FFD700" emissive="#FFD700" emissiveIntensity="0.8"
                               animation__pulse="property: scale; from: 1 1 1; to: 1.2 1.2 1.2; dur: 2000; dir: alternate; loop: true; easing: easeInOutSine"></a-icosahedron>
            </a-octahedron>
            <a-text value="Prisma Estelar" align="center" color="#FFF" position="0 2.5 0" width="5"></a-text>
        </a-entity>

        <!-- Roda Celeste dos 12 Raios -->
        <a-entity id="roda-celeste" position="0 2 0" animation="property: rotation; to: 0 360 0; dur: 120000; loop: true; easing: linear">
            <!-- Os 12 raios serão gerados dinamicamente via script -->
        </a-entity>

    </a-scene>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializa Tone.js para a sinfonia cósmica
            const synth = new Tone.PolySynth(Tone.Synth, {
                oscillator: { type: "triangle8" },
                envelope: { attack: 0.8, decay: 0.5, sustain: 0.6, release: 2 },
                volume: -12
            }).toDestination();
            const reverb = new Tone.Reverb(4).toDestination();
            synth.connect(reverb);

            const activeRaysList = document.getElementById('activeRays');

            const raiosEstelares = [
                { nome: "Vontade Divina", cor: "#FF0000", nota: "C4" },
                { nome: "Sabedoria", cor: "#FFD700", nota: "D4" },
                { nome: "Amor Incondicional", cor: "#FF69B4", nota: "E4" },
                { nome: "Pureza e Ascensão", cor: "#FFFFFF", nota: "F4" },
                { nome: "Cura e Verdade", cor: "#00FF00", nota: "G4" },
                { nome: "Serviço e Devoção", cor: "#FF4500", nota: "A4" },
                { nome: "Transmutação e Liberdade", cor: "#8A2BE2", nota: "B4" },
                { nome: "Clareza e Percepção", cor: "#ADD8E6", nota: "C5" },
                { nome: "Harmonia e Equilíbrio", cor: "#98FB98", nota: "D5" },
                { nome: "Paz e Paciência", cor: "#F0E68C", nota: "E5" },
                { nome: "Alegria e Propósito", cor: "#FFA07A", nota: "F5" },
                { nome: "Síntese e Unidade", cor: "#DDA0DD", nota: "G5" }
            ];

            const rodaCeleste = document.getElementById('roda-celeste');
            const anguloIncremento = 360 / raiosEstelares.length;
            const raio = 8;

            raiosEstelares.forEach((raioData, index) => {
                const angulo = (anguloIncremento * index) * (Math.PI / 180);
                const x = raio * Math.cos(angulo);
                const z = raio * Math.sin(angulo);

                const esferaRaio = document.createElement('a-sphere');
                esferaRaio.setAttribute('radius', '0.5');
                esferaRaio.setAttribute('position', `${x} 0 ${z}`);
                esferaRaio.setAttribute('material', `color: ${raioData.cor}; emissive: ${raioData.cor}; emissiveIntensity: 0.4;`);
                esferaRaio.setAttribute('class', 'collidable');
                esferaRaio.setAttribute('data-nome', raioData.nome);
                esferaRaio.setAttribute('data-nota', raioData.nota);

                esferaRaio.innerHTML = `<a-text value="${raioData.nome}" align="center" color="#FFF" position="0 0.8 0" width="3"></a-text>`;
                
                // Animação de pulsação individual
                esferaRaio.setAttribute('animation', `property: material.emissiveIntensity; from: 0.4; to: 0.8; dur: ${2000 + Math.random() * 1000}; dir: alternate; loop: true; easing: easeInOutSine`);

                // Linha de conexão ao centro
                const linha = document.createElement('a-entity');
                linha.setAttribute('line', `start: 0 0 0; end: ${x} 0 ${z}; color: ${raioData.cor}; opacity: 0.3`);
                
                rodaCeleste.appendChild(esferaRaio);
                rodaCeleste.appendChild(linha);

                // Interação
                esferaRaio.addEventListener('click', () => {
                    synth.triggerAttackRelease(raioData.nota, '2n');
                    updateActiveRaysPanel(raioData.nome, raioData.cor);
                });
            });

            function updateActiveRaysPanel(nome, cor) {
                if(activeRaysList.children.length > 0 && activeRaysList.children[0].textContent.includes('Aguardando')) {
                    activeRaysList.innerHTML = '';
                }
                const li = document.createElement('li');
                li.innerHTML = `<strong style="color:${cor}; text-shadow: 0 0 5px ${cor};">●</strong> ${nome}`;
                activeRaysList.prepend(li);
                if (activeRaysList.children.length > 4) {
                    activeRaysList.removeChild(activeRaysList.lastChild);
                }
            }

            // Iniciar som ambiente
            const ambientSynth = new Tone.MembraneSynth({
                pitchDecay: 0.008,
                octaves: 10,
                oscillator: { type: "sine" },
                envelope: { attack: 0.001, decay: 0.5, sustain: 0.01, release: 1.4, attackCurve: "exponential" }
            }).toDestination();
            ambientSynth.volume.value = -25;
            
            new Tone.Loop(time => {
                ambientSynth.triggerAttackRelease("C2", "8n", time);
            }, "